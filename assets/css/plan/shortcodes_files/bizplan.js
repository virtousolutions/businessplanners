
bpo.plan={reload:function(){window.location.href="plan";},setPlanId:function(planId){if(bpo.plan.planId===undefined||bpo.plan.planId===planId){bpo.plan.planId=planId;}else{bpo.changePage();bpo.plan.reload();}},initializeOutlineNavigator:function(){if($j('#view-tasks').data('initialized')){return;}
$j('#view-tasks span.title').hover(function(){$j(this).addClass('hover');},function(){$j(this).removeClass('hover');});$j('#view-tasks a.chapter, #view-tasks a.section').click(function(event){event.preventDefault();$j('#view-tasks .active').removeClass('active');$j(this).parent().addClass('active');$j('#view-tasks .expanded').each(function(idx,el){if($j(this).find('.active').length===0){$j(this).find('ul').slideUp(100);}});if($j(this).hasClass('chapter')){$j(this).parent().siblings('ul').slideDown(100);$j(this).parent().parent().addClass('expanded');}});function toggleSidebar(){if($j('body').hasClass('sidebar-left')){$j('.view-toggle').unbind('click');$j("#breadcrumbs").animate({marginTop:0},{queue:false,duration:'200'});$j("#view").animate({marginTop:0},{queue:false,duration:'200'});$j('body').removeClass('sidebar-left');setTimeout(function(){$j("#view").animate({marginLeft:-247},{queue:false,duration:'200'});$j("#content").animate({width:893},{queue:false,duration:'200'});$j('body').addClass('full');},300);setTimeout(function(){$j('.view-toggle').bind('click',toggleSidebar);},600);}
else if($j('body').hasClass('full')){$j('.view-toggle').unbind('click');$j("#content").animate({width:646},{queue:false,duration:'200'});$j("#view").animate({marginLeft:0},{queue:false,duration:'200'});setTimeout(function(){$j("#breadcrumbs").animate({marginTop:-25},{queue:false,duration:'200'});$j("#view").animate({marginTop:0},{queue:false,duration:'200'});},300);setTimeout(function(){$j('body').addClass('sidebar-left');$j('body').removeClass('full');$j('.view-toggle').bind('click',toggleSidebar);},600);}}
$j('.view-toggle').bind('click',toggleSidebar);},prepareDynamicDates:function(date){$j('span.last-saved .timeago').attr("title",(date||new Date()).format('c'));},initialize:function(){this.initializeOutlineNavigator();bpo.eventbus.fireEvent('poll',1);return;}};if(document.getElementById("view-tasks")){bpo.plan.initializeOutlineNavigator();}
$j(function(){function abbrNum(number,decPlaces){decPlaces=Math.pow(10,decPlaces);var abbrev=["k","m","b","t"];for(var i=abbrev.length-1;i>=0;i--){var size=Math.pow(10,(i+1)*3);if(size<=number){number=Math.round(number*decPlaces/size)/decPlaces;number+=abbrev[i];break;}}
return'$'+number;}
$j('tbody tr.product-row td.input span').each(function(){$j(this).attr("title",$j(this).text());$j(this).html(abbrNum($j(this).text(),0));});$j('.text .drawer-toggle').live('click',function(event){if($j(this).hasClass('expanded')){$j(this).parents('.container-wrapper').children('.drawer-wrapper').slideUp(100);$j(this).html('<span>Examples</span>');$j(this).removeClass('expanded');}
else{$j(this).parents('.container-wrapper').children('.drawer-wrapper').slideDown(100);$j(this).html('<span>Examples</span>');$j(this).addClass('expanded');}});$j('li.settings').tooltip({tip:'#settings-tooltip',position:'bottom left',offset:[0,110],delay:0,effect:'slide',predelay:0,direction:'down',events:{def:'null,null',tooltip:'null,null'},onHide:function(){if($j('li.settings li.tooltips').hasClass('tooltips-off')){$j('body').addClass('tooltips-off');}}}).dynamic({bottom:{direction:'up'}});var settingsToggle=$j('li.settings').data('tooltip');$j('li.settings li.tooltips').click(function(){if($j(this).hasClass('tooltips-off')){$j('li.settings li.tooltips a').text('Turn Tooltips Off');$j('#settings-tooltip p').text('Tooltips are now on.');$j(this).removeClass('tooltips-off');$j('body').removeClass('tooltips-off');settingsToggle.show();setTimeout(function(){settingsToggle.hide();},1000);}else{$j('li.settings li.tooltips a').text('Turn Tooltips On');$j('#settings-tooltip p').text('Tooltips are now off.');$j(this).addClass('tooltips-off');settingsToggle.show();setTimeout(function(){settingsToggle.hide();},1000);}});$j('li.settings li.helpers').click(function(){if($j(this).hasClass('helpers-off')){$j('li.settings li.helpers a').text('Turn Helpers Off');$j('#settings-tooltip p').text('Helpers are now on.');$j(this).removeClass('helpers-off');$j('body').removeClass('helpers-off');settingsToggle.show();setTimeout(function(){settingsToggle.hide();},1000);}else{$j('li.settings li.helpers a').text('Turn Helpers On');$j('#settings-tooltip p').text('Helpers are now off.');$j(this).addClass('helpers-off');$j('body').addClass('helpers-off');settingsToggle.show();setTimeout(function(){settingsToggle.hide();},1000);}});$j('.button.save').tooltip({tip:'#save-tooltip',position:'bottom center',offset:[5,0],effect:'slide',predelay:750,direction:'down'}).dynamic({bottom:{direction:'top'}});$j('li a.locked').tooltip({tip:'#locked-tooltip',position:'center right',offset:[0,0],effect:'slide',delay:0,predelay:0,direction:'right',events:{def:'click, blur',tooltip:'click, click'}});var lockedTip=$j('li a.locked').data('tooltip');$j('#locked-tooltip a').click(function(){lockedTip.hide();});});if(typeof this['dwr']=='undefined')this.dwr={};if(typeof dwr['engine']=='undefined')dwr.engine={};if(typeof dwr.engine['_mappedClasses']=='undefined')dwr.engine._mappedClasses={};if(typeof this['dwr']=='undefined')this.dwr={};if(typeof dwr['engine']=='undefined')dwr.engine={};if(typeof dwr.engine['_mappedClasses']=='undefined')dwr.engine._mappedClasses={};if(window['dojo'])dojo.provide('dwr.interface.planRemote');if(typeof this['planRemote']=='undefined')planRemote={};planRemote._path=''+JAWR.jawr_dwr_path+'';planRemote.renameNode=function(p0,p1,callback){return dwr.engine._execute(planRemote._path,'planRemote','renameNode',arguments);};planRemote.toggleShowInstructions=function(p0,p1,callback){return dwr.engine._execute(planRemote._path,'planRemote','toggleShowInstructions',arguments);};planRemote.disableChapterTwoHelp=function(callback){return dwr.engine._execute(planRemote._path,'planRemote','disableChapterTwoHelp',arguments);};planRemote.disableExecutiveSummaryHelp=function(callback){return dwr.engine._execute(planRemote._path,'planRemote','disableExecutiveSummaryHelp',arguments);};if(typeof this['dwr']=='undefined')this.dwr={};if(typeof dwr['engine']=='undefined')dwr.engine={};if(typeof dwr.engine['_mappedClasses']=='undefined')dwr.engine._mappedClasses={};if(typeof this['dwr']=='undefined')this.dwr={};if(typeof dwr['engine']=='undefined')dwr.engine={};if(typeof dwr.engine['_mappedClasses']=='undefined')dwr.engine._mappedClasses={};if(window['dojo'])dojo.provide('dwr.interface.textWidget');if(typeof this['textWidget']=='undefined')textWidget={};textWidget._path=''+JAWR.jawr_dwr_path+'';textWidget.getText=function(p0,callback){return dwr.engine._execute(textWidget._path,'textWidget','getText',arguments);};textWidget.setText=function(p0,p1,callback){return dwr.engine._execute(textWidget._path,'textWidget','setText',arguments);};textWidget.editText=function(callback){return dwr.engine._execute(textWidget._path,'textWidget','editText',arguments);};if(typeof this['dwr']=='undefined')this.dwr={};if(typeof dwr['engine']=='undefined')dwr.engine={};if(typeof dwr.engine['_mappedClasses']=='undefined')dwr.engine._mappedClasses={};if(typeof this['dwr']=='undefined')this.dwr={};if(typeof dwr['engine']=='undefined')dwr.engine={};if(typeof dwr.engine['_mappedClasses']=='undefined')dwr.engine._mappedClasses={};if(window['dojo'])dojo.provide('dwr.interface.userRemote');if(typeof this['userRemote']=='undefined')userRemote={};userRemote._path=''+JAWR.jawr_dwr_path+'';userRemote.toggleInstructions=function(p0,callback){return dwr.engine._execute(userRemote._path,'userRemote','toggleInstructions',arguments);};if(typeof this['dwr']=='undefined')this.dwr={};if(typeof dwr['engine']=='undefined')dwr.engine={};if(typeof dwr.engine['_mappedClasses']=='undefined')dwr.engine._mappedClasses={};if(typeof this['dwr']=='undefined')this.dwr={};if(typeof dwr['engine']=='undefined')dwr.engine={};if(typeof dwr.engine['_mappedClasses']=='undefined')dwr.engine._mappedClasses={};if(window['dojo'])dojo.provide('dwr.interface.salesForecast');if(typeof this['salesForecast']=='undefined')salesForecast={};salesForecast._path=''+JAWR.jawr_dwr_path+'';salesForecast.init=function(callback){return dwr.engine._execute(salesForecast._path,'salesForecast','init',arguments);};salesForecast.setValues=function(p0,p1,p2,p3,p4,callback){return dwr.engine._execute(salesForecast._path,'salesForecast','setValues',arguments);};salesForecast.setProductOrder=function(p0,callback){return dwr.engine._execute(salesForecast._path,'salesForecast','setProductOrder',arguments);};salesForecast.addNewProduct=function(callback){return dwr.engine._execute(salesForecast._path,'salesForecast','addNewProduct',arguments);};salesForecast.deleteProduct=function(callback){return dwr.engine._execute(salesForecast._path,'salesForecast','deleteProduct',arguments);};salesForecast.deleteProduct=function(p0,callback){return dwr.engine._execute(salesForecast._path,'salesForecast','deleteProduct',arguments);};salesForecast.renameProduct=function(callback){return dwr.engine._execute(salesForecast._path,'salesForecast','renameProduct',arguments);};salesForecast.renameProduct=function(p0,p1,callback){return dwr.engine._execute(salesForecast._path,'salesForecast','renameProduct',arguments);};salesForecast.getSelectedProduct=function(callback){return dwr.engine._execute(salesForecast._path,'salesForecast','getSelectedProduct',arguments);};salesForecast.setSelectedProduct=function(p0,callback){return dwr.engine._execute(salesForecast._path,'salesForecast','setSelectedProduct',arguments);};Ext.namespace("bpo.publish");$j(function(){$j('#display-settings h3').hover(function(){$j(this).addClass('hover');},function(){$j(this).removeClass('hover');});$j('#view #display-settings h3').click(function(){$j(this).siblings('.settings-group').slideToggle(100);$j(this).parent().toggleClass('expanded');$j(this).disableSelection();});$j('.plan-browser .scrollable').scrollable({items:'.plan-panes',prev:'#preview-page .back',next:'#preview-page .next'}).navigator({navi:'#preview-page .paginate'});$j('ul.font-picker li').click(function(){$j('#content').attr('class','');$j('#content').addClass($j(this).attr('class'));});function togglePageNumberFormat(){if($j('label[for="publishForm:page_number_footer"] input:checkbox').is(':checked')){$j('#pageNumberRadioButtonGroup_container').show();}else{$j('#pageNumberRadioButtonGroup_container').hide();}}
togglePageNumberFormat();$j('label[for="publishForm:page_number_footer"]').click(function(){togglePageNumberFormat();});function toggleConfidentialityStatement(){if($j('label[for="publishForm:confidentiality_statement_toggle"] input:checkbox').is(':checked')){$j('#confidentiality_statement').show();}else{$j('#confidentiality_statement').hide();}}
toggleConfidentialityStatement();$j('label[for="publishForm:confidentiality_statement_toggle"]').click(function(){toggleConfidentialityStatement();});$j('li.settings').tooltip({tip:'#settings-tooltip',position:'bottom left',offset:[0,110],delay:0,effect:'slide',predelay:0,direction:'down',events:{def:'null,null',tooltip:'null,null'},onHide:function(){if($j('li.settings li.tooltips').hasClass('tooltips-off')){$j('body').addClass('tooltips-off');}}}).dynamic({bottom:{direction:'up'}});var settingsToggle=$j('li.settings').data('tooltip');$j('li.settings li.tooltips').click(function(){if($j(this).hasClass('tooltips-off')){$j('li.settings li.tooltips a').text('Turn Tooltips Off');$j('#settings-tooltip p').text('Tooltips are now on.');$j(this).removeClass('tooltips-off');$j('body').removeClass('tooltips-off');settingsToggle.show();setTimeout(function(){settingsToggle.hide();},1000);}else{$j('li.settings li.tooltips a').text('Turn Tooltips On');$j('#settings-tooltip p').text('Tooltips are now off.');$j(this).addClass('tooltips-off');settingsToggle.show();setTimeout(function(){settingsToggle.hide();},1000);}});$j('li.settings li.helpers').click(function(){if($j(this).hasClass('helpers-off')){$j('li.settings li.helpers a').text('Turn Helpers Off');$j('#settings-tooltip p').text('Helpers are now on.');$j(this).removeClass('helpers-off');$j('body').removeClass('helpers-off');settingsToggle.show();setTimeout(function(){settingsToggle.hide();},1000);}else{$j('li.settings li.helpers a').text('Turn Helpers On');$j('#settings-tooltip p').text('Helpers are now off.');$j(this).addClass('helpers-off');$j('body').addClass('helpers-off');settingsToggle.show();setTimeout(function(){settingsToggle.hide();},1000);}});});bpo.publish.confidentialityStatementEditor={getEditorInstance:function(){return window.CKEDITOR.instances[this.instanceName];},isDataChanged:function(){var ed=this.getEditorInstance();if(!ed){return false;}
var newData=ed.getData().replace(new RegExp("\\u000D","g"),"");var oldData=$j(document.getElementById(this.instanceName)).val().replace(new RegExp("\\u000D","g"),"");return newData!==oldData;},update:function(){var ed=this.getEditorInstance();if(!ed){return false;}
$j(document.getElementById(this.instanceName)).val(ed.getData()).change();},destroy:function(){if(this.getEditorInstance()){this.getEditorInstance().destroy();}},init:function(editor,saveCallback){this.instanceName=editor;this.saveForm=saveCallback;if(!CKEDITOR.env.isCompatible){var confidentialText=$j('#'+this.instanceName.replace(':',"\\:"));confidentialText.replaceWith($j('<div>'+confidentialText.text()+'</div>'));$j('#confidentiality_statement_editor_too_long').hide();$j('#confidentiality_statement_editor_not_supported').show();return;}
if(this.getEditorInstance()){console.log(this.instanceName+" already initialized");return;}
window.CKEDITOR.replace(this.instanceName,{language:'en',customConfig:'',autoUpdateElement:false,resize_enabled:false,toolbar:[['Bold','Italic','Underline']],toolbarCanCollapse:false,scayt_autoStartup:false,forcePasteAsPlainText:true,width:'580px',height:'80px',disableNativeSpellChecker:false,removePlugins:'smiley,elementspath,scayt,colorbutton,colordialog,filebrowser,find,flash,forms,horizontalrule,image,print,preview,table,tabletools,specialchar,templates'});var outerThis=this;setInterval(function(){if(!outerThis.isDataChanged()){return;}
outerThis.update();},2000);}};bpo.publish.printOverlay=function(messaging){var pendingTitle=messaging.header1;var pendingContent=messaging.content1;var completedTitle=messaging.header2;var completedContent=messaging.content2;var overlay=new Ext.ux.Overlay({title:pendingTitle,width:320,height:180,items:[{html:"<div class=\"spinner\"><p>"+pendingContent+"</p></div>",border:false}],buttons:[{text:'Cancel',xtype:'aquabutton',color:'text',scope:this,isVisible:false},'or',{text:"Download",xtype:'aquabutton',color:'primary',scope:this,isVisible:false}]});return{show:function(){overlay.buttons[0].setVisible(false);overlay.buttons[1].setVisible(false);overlay.buttons[2].setVisible(false);overlay.show();},ready:function(){overlay.setTitle(completedTitle);overlay.removeAll();overlay.doLayout();overlay.setHeight(270);overlay.add([{html:"<p>"+completedContent+"</p>",border:false}]);overlay.doLayout();var buttons=overlay.buttons;buttons[0].handler=function(){overlay.destroy();};buttons[2].handler=function(){window.location="/publish";overlay.destroy();};buttons[0].setVisible(true);buttons[1].setVisible(true);buttons[2].setVisible(true);}};};bpo.createChart=function(cfg){if(cfg.xlabels){cfg.categories=cfg.xlabels;}
var xFormatter,yFormatter,dataColor;xFormatter=function(){if('string'===typeof this.value){return this.value.replace('Month ','').replace('Year ','');}};dataColor=function(idx,data){if(typeof data!=='number'){data=1;}
var colors=[["#137cc6","#3fa9f5"],["#049053","#0CAD67"]];return(colors[idx][data<0?1:0]);};switch(cfg.unitType){case'currency':yFormatter=function(){return window.localMoney(Math.round(this.value)).replace('.00','');};break;case'percent':yFormatter=function(){return Math.floor(this.value*100)+'%';};break;}
var seriesCache=[],legendItemClickFn=function(event){event.preventDefault();cfg.events.click();};$j.each(cfg.data,function(idx,series){var thisSerie={name:cfg.seriesName[idx],color:dataColor(idx),borderWidth:0,data:[],events:{legendItemClick:legendItemClickFn}};$j.each(series,function(dataIdx,datum){thisSerie.data.push({y:datum,color:dataColor(idx,datum)});});seriesCache.push(thisSerie);});var c=new window.Highcharts.Chart({credits:{enabled:false},title:null,colors:['#3fa9f5','#3fa9f5','#3fa9f5','#3fa9f5','#3fa9f5','#3fa9f5','#3fa9f5','#3fa9f5','#3fa9f5','#3fa9f5'],chart:{width:619,height:400,marginBottom:50,marginLeft:80,animation:false,renderTo:cfg.renderTo,events:cfg.events,type:'column'},legend:seriesCache.length===1?false:{align:'right',verticalAlign:'middle',layout:'vertical',borderWidth:0,itemStyle:{color:'#3E576F',cursor:'default'},itemHoverStyle:{color:'#3E576F'}},plotOptions:{series:{animation:false},column:{shadow:false,enableMouseTracking:false}},xAxis:{categories:cfg.categories,tickLength:null,title:cfg.xAxisTitle?{text:cfg.xAxisTitle,margin:10,style:{color:'#666676'}}:false,labels:{'formatter':xFormatter}},yAxis:{tickLength:null,gridLineDashStyle:'longdash',plotLines:[{color:'#c0c0c0',width:1,value:0,zIndex:3}],title:{text:null},labels:{'formatter':yFormatter}},exporting:{enabled:false},series:seriesCache});return c;};bpo.simpleFinancialYearEditor={initYearEditor:function(target,cfg){var el=Ext.get(target),inputs=el.select('input.financial-period-value'),updateTotal=this.updateTotal;inputs.on('keyup',function(e,el){var values,row=Ext.fly(el).parent('.row');values=this.getValues(row);Ext.iterate(values,function(key,value){var total=0;Ext.each(value,function(v){total+=v;});total=parseFloat(total.toFixed(2));if(Ext.get("financialyear-"+cfg.uuid)){if(Ext.get("financialyear-"+cfg.uuid).select('.column-total.AVERAGE[rel='+key+']').getCount()>0){total=total/value.length;}
var formattedTotal=total;if(Ext.get("financialyear-"+cfg.uuid).select('.column-total.CURRENCY[rel='+key+']').getCount()>0){formattedTotal=window.localMoney(total).replace('.00','');}
updateTotal(formattedTotal,row,key,cfg.uuid);}});},this);el.select('.row.values').each(this.getValues);},updateTotal:function(total,row,year,uuid){var totalSelector='.column-total[rel='+year+'] .td';if(total!==undefined&&Ext.get("financialyear-"+uuid).select(totalSelector).getCount()){$j("#financialyear-"+uuid).find(totalSelector).find('p').text(total);}else if(uuid){if(window.reRenderContexts&&$j('div[rel='+uuid+']').length===0){window.reRenderContexts();}}
if(Ext.WindowMgr.get('preview')&&Ext.WindowMgr.get('preview').isVisible()){window.reRenderPreview();}},getValues:function(row){var values={};row.select('input').each(function(v){var year=v.parent('.column').getAttribute('rel');if(!values[year]){values[year]=[];}
values[year].push(bpo.num(v.getValue(),0));});return values;},updateDisplayValues:function(uuid){var editor=$j('#'+uuid);if(editor.length){var displayYears=editor.find('.display-cell'),sourceYears=editor.find('.display-source-cell');displayYears.each(function(idx){$j(this).html($j(sourceYears.get(idx)).html());});}}};bpo.simpleFinancialYearEditorWithWeightedAverages={initYearEditor:function(target,cfg){var el=Ext.get(target),inputs=el.select('input.financial-period-value'),updateTotal=this.updateTotal;inputs.on('keyup',function(e,el){var values,unitValues,row=Ext.fly(el).parent('.row');values=this.getValues(row);unitValues=this.getUnitValues(cfg.quantityUuid);Ext.iterate(values,function(key,value){var priceTotal=0;var unitTotal=0;var weightedTotal=0;var total=0;Ext.each(value,function(v){priceTotal+=v;});Ext.each(unitValues[key],function(v,index){unitTotal+=v;weightedTotal+=v*value[index];});if(unitTotal>0){total=weightedTotal/unitTotal;}
else{total=priceTotal/value.length;}
var formattedTotal=total;if(Ext.get("financialyear-"+cfg.uuid).select('.column-total.CURRENCY[rel='+key+']').getCount()>0){formattedTotal=window.localMoney(total).replace('.00','');}
updateTotal(formattedTotal,row,key,cfg.uuid);});},this);var quantityEl=Ext.get(cfg.quantityUuid),quantityInputs=quantityEl.select('input.financial-period-value');quantityInputs.on('keyup',function(e,el){var values,unitValues,row=Ext.fly(el).parent('.row');values=this.getPriceValues(target);unitValues=this.getUnitValues(cfg.quantityUuid);Ext.iterate(values,function(key,value){var priceTotal=0;var unitTotal=0;var weightedTotal=0;var total=0;Ext.each(value,function(v){priceTotal+=v;});Ext.each(unitValues[key],function(v,index){unitTotal+=v;weightedTotal+=v*value[index];});if(unitTotal>0){total=weightedTotal/unitTotal;}
else{total=priceTotal/value.length;}
var formattedTotal=total;if(Ext.get("financialyear-"+cfg.uuid).select('.column-total.CURRENCY[rel='+key+']').getCount()>0){formattedTotal=window.localMoney(total).replace('.00','');}
updateTotal(formattedTotal,row,key,cfg.uuid);});},this);el.select('.row.values').each(this.getValues);},updateTotal:function(total,row,year,uuid){var totalSelector='.column-total[rel='+year+'] .td';if(total!==undefined&&Ext.get("financialyear-"+uuid).select(totalSelector).getCount()){$j("#financialyear-"+uuid).find(totalSelector).find('p').text(total);}else if(uuid){if(window.reRenderContexts&&$j('div[rel='+uuid+']').length===0){window.reRenderContexts();}}
if(Ext.WindowMgr.get('preview')&&Ext.WindowMgr.get('preview').isVisible()){window.reRenderPreview();}},getValues:function(row){var values={};row.select('input[type="text"]').each(function(v){var year=v.parent('.column').getAttribute('rel');if(!values[year]){values[year]=[];}
values[year].push(bpo.num(v.getValue(),0));});return values;},getUnitValues:function(quantityUuid){var values={};var el=Ext.get(quantityUuid),inputs=el.select('input[type="text"]');inputs.each(function(v){var year=v.parent('.column').getAttribute('rel');if(!values[year]){values[year]=[];}
values[year].push(bpo.num(v.getValue(),0));});return values;},getPriceValues:function(priceUuid){var values={};var el=Ext.get(priceUuid),inputs=el.select('input[type="text"]');inputs.each(function(v){var year=v.parent('.column').getAttribute('rel');if(!values[year]){values[year]=[];}
values[year].push(bpo.num(v.getValue(),0));});return values;},updateDisplayValues:function(uuid){var editor=$j('#'+uuid);if(editor.length){var displayYears=editor.find('.display-cell'),sourceYears=editor.find('.display-source-cell');displayYears.each(function(idx){$j(this).html($j(sourceYears.get(idx)).html());});}}};