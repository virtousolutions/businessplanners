
var noop=function(){};if(!window.console){console={};}
Ext.applyIf(console,{log:noop,dir:noop,time:noop,timeEnd:noop,profile:noop,profileEnd:noop,info:noop});Ext.WindowMgr.zseed=11000;window.localMoney=function(v){var currencySymbol=(function(){return window.currencySymbol||"";}());v=Math.round((v-0)*100)/100;v=v===Math.floor(v)?v+".00":v*10===Math.floor(v*10)?v+"0":v;v=String(v);var ps=v.split("."),whole=ps[0],sub=ps[1]?"."+ps[1]:".00",r=/(\d+)(\d{3})/;while(r.test(whole)){whole=whole.replace(r,"$1,$2");}
v=whole+sub;if(v.charAt(0)==="-"){return'('+currencySymbol+v.substr(1)+')';}
return currencySymbol+v;};Number.prototype.toFixedStrict=function(f){f=Ext.num(f,2);var val=this.valueOf(),t=Math.pow(10,f);if(val-Math.floor(val)>0){val=Math.floor(val*t)/t;val=val.toFixed(f);}
return val;};String.prototype.toFixedStrict=function(f){return Ext.num(this.valueOf(),0).toFixedStrict(f);};$j(function(){$j('body').live('click',function(e){if($j(e.target).is('.alert')||$j(e.target).is('.alert span')){var button=$j(e.target).closest('.alert');bpo.message.alert(button.data("message"),button.data("title"));}
if($j(e.target).is('.menu-arrow > span')){if($j(e.target).parents('.selector').hasClass('selected')){$j(e.target).parents('.selector').removeClass('selected');}else{$j('.selected').removeClass('selected');$j(e.target).parents('.selector').addClass('selected');$j('.selected li:first-child > *').textOverflow();}}
else if($j(e.target).parents('.selector').length!==0){if($j(e.target).is('.disabled span, .disabled a')){return;}
if(Ext.fly(e.target).parent('.selectableItem')){$j('.selected').removeClass('selected');Ext.fly(e.target).parent('.selectableItem').radioClass('disabled');var text=$j(e.target).text(),titleEl=Ext.fly(e.target).parent('.selector').child('.title:not(.fixed-title)');if(titleEl){titleEl.update(text);}}else{$j('.selected').removeClass('selected');$j(e.target).parents('.selector').toggleClass('selected');$j(e.target).parents('.selector').find('.drop-down').css('min-width',$j(e.target).parents('.selector').find('a.button').width());}}else{$j('.selected').removeClass('selected');}});bpo.truncateTitleText();$j('li').live('mouseover',function(event){$j(this).addClass('hover');}).live('mouseout',function(event){$j(this).removeClass('hover');});$j('input[title!=""], .edit textarea[title!=""]').hint();$j('form .validate-submit:not(.disabled)').live('click',function(){$j(this).parents('form:visible').submit();});$j('form:not(.no-enter) input').live('keyup',function(event){if(event.keyCode===13){$j(this).parents('form:visible').find('.validate-submit').click();}});$j(window).bind("resize.unexpose",function(evt){$j('#mask').css("height",$j(document).height());});$j('.intro-block-toggle').live('click',function(){if(!window.planRemote){return;}
if($j('.intro-block-toggle').hasClass('expanded')){$j('.intro-block').slideUp(100);$j('.intro-block-toggle').html('<span>Show Instructions</span>');$j('.intro-block-toggle').removeClass('expanded');window.planRemote.toggleShowInstructions(bpo.plan.selectedOutlineItemId,false);}
else{$j('.intro-block').slideDown(100);$j('.intro-block-toggle').html('<span>Hide Instructions</span>');$j('.intro-block-toggle').addClass('expanded');window.planRemote.toggleShowInstructions(bpo.plan.selectedOutlineItemId,true);}});$j('.comment-toggle a').live('click',function(){if($j(this).parents('.comment-toggle').hasClass('expanded')){$j(this).parents('.comment-toggle').siblings('.comments').slideUp(100);$j(this).parents('.comment-toggle').removeClass('expanded');}else{$j(this).parents('.comment-toggle').siblings('.comments').slideDown(100);$j(this).parents('.comment-toggle').addClass('expanded');}});$j('.comment.entry textarea').autoResize();$j('.section-message a.close').live('click',function(){$j(this).parents('.section-message').fadeOut();});$j('#outline span.title').live('mouseover',function(event){$j(this).addClass('hover');}).live('mouseout',function(event){$j(this).removeClass('hover');});var content=$j('#content'),sidebar=$j('#outline'),contentMinHeight=parseInt(content.css('min-height'),10);content.css('min-height',Math.max(contentMinHeight,sidebar.height()+1));$j('#outline li span a.function').live('click',function(){var content=$j('#content'),sidebar=$j('#outline');$j(this).parent().siblings('ul').slideToggle({duration:100,step:function(){content.css('min-height',Math.max(contentMinHeight,sidebar.height()+1));}});$j(this).parent().parent().toggleClass('expanded');});$j('a.chapter, a.section, div.section-widget').live('click',function(){if($j(this).data('outlineItem')){bpo.changePage(true);window.setSelectedOutlineItem($j(this).data('outlineItem'));}});$j('a.select-next-item').live('click',function(){bpo.changePage(false);$j(this).addClass("active");window.selectNextItem();bpo.trackEvent('Design','Used continue button');});$j('.coming-soon').live('click',function(){$j(this).tooltip({tip:'#incomplete-tooltip',position:$j(this).offset().top>100?'top center':'bottom center',offset:$j(this).offset().top>100?[0,0]:[20,20],effect:'slide',delay:0,predelay:0,events:{def:'click, mouseleave'}}).dynamic({bottom:{direction:'down'}});var comingSoon=$j(this).data('tooltip');comingSoon.show();});bpo.initActiveInput();var em=$j.validator.methods.email;$j.validator.methods.email=function(val,el){$j(el).val($j(el).val().trim());return em.call(this,$j(el).val(),el);};(new Image()).src="/images/overlay_header.gif";(new Image()).src="/images/sprites/warning_48.png";(new Image()).src="/images/icons/loading.gif";(new Image()).src="/images/icons/ajax-loader-CACCD0-16px.gif";});window.bpo={online:true,checkLoggedInStatus:function(){if(window.loggedInStatus){window.loggedInStatus.getStatus(bpo.handleLoggedInStatus);}},initActiveInput:function(){$j('input.active-input').live('hover focus blur mouseup change',function(event){var t=$j(this);switch(event.type){case'mouseover':t.addClass('over');break;case'mouseout':t.removeClass('over');break;case'focusin':t.select();t.addClass('focus');if(t.data('tooltip')){var offsetLeftInContainer=$j(t).offset().left-$j(t).parent().offset().left;var offsetTopInContainer=$j(t).offset().top-$j(t).parent().offset().top;var tooltip=t.data('tooltip');tooltip.css({'visibility':'hidden','display':'block'});tooltip.show();var tooltipHeight=tooltip.find('.error-tooltip-inner').height(),tooltipWidth=tooltip.find('.error-tooltip-inner').width();tooltip.css({'visibility':'visible','top':offsetTopInContainer-(tooltipHeight+24)});var documentWidth=$j(document).width();if(t.offset().left>(documentWidth/2)){tooltip.css('left',0-(offsetLeftInContainer+tooltipWidth-t.width())).addClass('right');}else{tooltip.css('left',offsetLeftInContainer);}
tooltip.hide();tooltip.fadeIn();}
break;case'focusout':t.removeClass('focus');if(t.data('tooltip')){t.data('tooltip').fadeOut();}
break;case'mouseup':event.preventDefault();break;case'change':bpo.markError(t);break;}});},handleLoggedInStatus:function(status){if(!window.bpo.online){window.bpo.online=true;bpo.eventbus.fireEvent('restoredconnection');}
if(status==="LOGGED_IN"){return;}else if(status==="LOGGED_OUT_TIMEOUT"){bpo.handleLogoutFromInactivity();}else if(status==="LOGGED_OUT_NEW_SESSION"){bpo.handleLogoutFromNewSession();}else{console.error("Unhandled status from loggedInStatus: "+status);}
bpo.eventbus.removeListener("poll",bpo.checkLoggedInStatus);},handleLogoutFromInactivity:function(){bpo.message.error("You have been logged out after a period of inactivity to prevent unauthorized use of your account. Please log in again.".l(),"Please Log In Again".l(),function(){window.location=bpo.app.fatalUrl;},{'icon':'images/sprites/clock_64.png',width:350,fatal:true});bpo.poller.stop();},handleLogoutFromNewSession:function(){bpo.message.error("You have been logged out because you are logged in at another location. A single login cannot be used in multiple locations at once.".l(),"Login Conflict".l(),function(){window.location=bpo.app.fatalUrl;},{fatal:true});bpo.poller.stop();},dimAjaxArea:function(classSelector,fadeOut){if(fadeOut!==false){fadeOut=true;}
if(classSelector.substring(0,"dim-action-".length)!=="dim-action-"){console.log("dimAjaxArea with invalid class selector '"+classSelector+"'");return;}
Ext.select('.'+classSelector).each(function(el){var toFade=new Ext.CompositeElement(),loadEl=el.child('.loading-widgets');toFade.add(el.dom.childNodes);toFade.removeElement(loadEl);toFade.setOpacity(0.0,fadeOut);var parent=el;var loading=(loadEl||parent.createChild({cls:'loading-widgets'}));var alignTo=loading.getAlignToXY(el,'c-c');alignTo[1]=Math.min(200+el.getY(),alignTo[1]);loading.setXY(alignTo);});},

showExpertAdvice:function(expertAdviceUrl,title,transcriptionUrl){title=(title===undefined||title==="")?"Advice from Tim Berry":title;transcriptionUrl=(transcriptionUrl===undefined)?"":transcriptionUrl;var height=(transcriptionUrl==="")?368:398;var htmlContent='<iframe src="'+expertAdviceUrl+'" width="601" height="338" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';if(transcriptionUrl!==""){htmlContent+='<div class="video-transcription-link"><a href="'+transcriptionUrl+'" target="_blank">Click here for a full transcription of this video</a></div>';}
window.adviceWindow=(new Ext.ux.Overlay({closeAction:'close',closable:false,autoShow:true,title:title,width:631,height:height,items:[{html:htmlContent,border:false}],buttons:[{text:'Close'.l(),xtype:'aquabutton',color:'primary',handler:function(){window.adviceWindow.close();},scope:this}]}));window.adviceWindow.on('show',function(cmp){});window.adviceWindow.show();},


showDelete:function(expertAdviceUrl,title,transcriptionUrl){title=(title===undefined||title==="")?"Advice from Tim Berry":title;transcriptionUrl=(transcriptionUrl===undefined)?"":transcriptionUrl;var height=(transcriptionUrl==="")?180:198;var htmlContent='<iframe src="'+expertAdviceUrl+'" width="484" height="80" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';if(transcriptionUrl!==""){htmlContent+='<div class="video-transcription-link"><a href="'+transcriptionUrl+'" target="_blank">Click here to delete employee</a></div>';}
window.adviceWindow=(new Ext.ux.Overlay({closeAction:'close',closable:false,autoShow:true,title:title,width:484,height:height,items:[{html:htmlContent,border:false}],buttons:[{text:'Close'.l(),xtype:'aquabutton',color:'primary',handler:function(){window.adviceWindow.close();},scope:this}]}));window.adviceWindow.on('show',function(cmp){});window.adviceWindow.show();},




showFeedback:function(){if(!window.feedbackWindow){var saveFeedback,feedbackWindow;saveFeedback=function(){feedbackWindow.hide();window.saveFeedback();};feedbackWindow=(new Ext.ux.Overlay({closeAction:'hide',contentEl:'feedback-wrapper',autoShow:true,title:'Feedback',width:450,height:300,buttons:[{text:'Cancel'.l(),xtype:'aquabutton',color:'text',handler:function(){window.feedbackWindow.hide();},scope:this},'or'.l(),{text:'Submit'.l(),xtype:'aquabutton',color:'primary',handler:saveFeedback}]}));window.feedbackWindow=feedbackWindow;}
window.feedbackWindow.on('show',function(cmp){cmp.getEl().child("textarea").focus(250);});window.feedbackWindow.show();},showFeedbackResponse:function(){bpo.message.alertBar($j('#feedback-response-text').text());},updateAccountName:function(name){if(name){$j('.account-name-title, .selected-account-item .account-name').text(name);}
bpo.truncateTitleText();},updatePlanTitle:function(name){if(name){$j('.plan-title').text(name);}
bpo.truncateTitleText();},updateUserFullName:function(name){if(name){$j('.user-full-name').text(name);}
bpo.truncateTitleText();},truncateTitleText:function(){var rightWidth=30;$j('.title-right a, .title-right span').each(function(){rightWidth+=$j(this).width();});$j('.title-right').width(rightWidth);var titleWidth=$j('.header-line').width()-rightWidth-50;var titleTextWidth=titleWidth-$j('#title-prefix').width()-10;$j('h1 .title-text').show();$j('h1.title').width(titleWidth);$j('h1 .title-text').width(titleTextWidth).textOverflow();},truncateToWord:function(str,limit){var bits,i;if('string'!==typeof str){return'';}
bits=str.split('');if(bits.length>limit){for(i=bits.length-1;i>-1;--i){if(i>limit){bits.length=i;}
else if(' '===bits[i]){bits.length=i;break;}}
while(bits.length>(limit-3)){bits.pop();}
bits.push('...');}
return bits.join('');},changePage:function(dim){if(dim!==false){bpo.dimAjaxArea('dim-action-active-page');}
if(bpo.widgetRegistry){bpo.widgetRegistry.setReadOnly(true,true);}
bpo.eventbus.fireEvent('changepage');bpo.scrollToTop();$j('#showMessage').fadeOut();},scrollToTop:function(){$j('html, body').animate({scrollTop:0},'fast');},num:function(v,defaultValue){if(Ext.isEmpty(v)||Ext.isArray(v)||typeof v==='boolean'||(typeof v==='string'&&v.trim().length===0)){return defaultValue;}
var cleaned=v.replace(/\,/g,'');var asNumber=Number(cleaned);return isNaN(asNumber)?defaultValue:asNumber;},trackPage:function(url){if(window._gaq){var tpv=['_trackPageview'];if(url){tpv.push(location.pathname+"/"+url);}
window._gaq.push(tpv);}},trackEvent:function(category,action,label,value){if(window._gaq){window._gaq.push(['_trackEvent',category,action,label,value]);}},exceedsPlanCap:function(displaySwitch,canHaveMultiplePlans,allowUpgrade){var isOwner=(displaySwitch==='OWNER');var isPartner=(displaySwitch==='PARTNER');var message;var callback;if(isOwner){if(allowUpgrade){message='Your account currently has as many active plans as it allows.'.l()+' '
+'To create a new plan, archive an active plan first to make room under the limit.'.l()+' '
+'All of its data will be retained.'.l()+'<br /><br />'
+'Alternatively, you can upgrade your account to allow a higher number of active plans.'.l()+' '
+'<a href="/account#account-level">'+'View upgrade options'.l()+'</a>';}else{message='Your account currently has as many active plans as it allows.'.l()+' '
+'To create a new plan, archive an active plan first to make room under the limit.'.l()+' '
+'All of its data will be retained.'.l()+'<br /><br />'
+'Please contact us if you want to upgrade your account to allow a higher number of active plans.'.l();}
callback=function(id){if(isOwner){window.location="/plans";}};bpo.message.alert(message,"Plan Limit Reached".l(),callback,{closable:false});}else if(isPartner&&canHaveMultiplePlans){message='Your account currently has as many active plans as it allows.'.l()+'<br />'+'You can <a href="/plans">go to the My Plans page</a> and archive the currently active plan to make room under the limit.'.l();callback=function(id){window.location="/plans";};bpo.message.alert(message,"Plan Limit Reached".l(),callback);}else if(isPartner&&!canHaveMultiplePlans){message="Only one plan can be active for editing at a time.</p><p>To create another plan, first use the \"Archive\" option "+"to deactivate your currently active plan. Don't worry — the plan's data will be retained, and you can restore it to active "+"status at any point.".l();callback=function(id){window.location="/plans";};bpo.message.alert(message,"Another plan is already active".l(),callback,{closable:false});}else{message='This account currently has as many active plans as it allows.'.l()+' '+'You can archive an active plan to make room under the limit.'.l()+' '+'Or you can ask the account owner ('.l()+'<strong>'+displaySwitch+'</strong>'+') to upgrade the account to support a higher number of active plans.'.l();callback=function(id){window.location="/plan";};bpo.message.alert(message,"Plan Limit Reached".l(),callback,{closable:false});}},validateAllActiveInput:function(){$j('.active-input').each(function(index){bpo.markError(this);});},markError:function(t,autoCorrect){if(autoCorrect===undefined){autoCorrect=true;}else{autoCorrect=false;}
t=t?$j(t):$j(this);if(!(t.hasClass('active-input'))){return;}
var error=false;if(t.data('error')!==undefined){error=t.data('error');}
if(t.hasClass('numeric')){if(t.val().length===0&&autoCorrect&&!t.hasClass('allow-blank')){t.val(0);}
if(t.val().length===0&&t.hasClass('allow-blank')){return;}else if(bpo.num(t.val(),false)===false){error='You must enter a number';}else{var val=bpo.num(t.val());var fixedDecimals=2;var isInteger=(val===parseInt(val,10));if(t.hasClass('integer')||(t.hasClass('currency')&&isInteger)){fixedDecimals=0;}else if(t.hasClass('decimals-one')){fixedDecimals=1;}else if(t.hasClass('decimals-two')||(t.hasClass('currency')&&!isInteger)){fixedDecimals=2;}else if(t.hasClass('decimals-three')){fixedDecimals=3;}
val=val.toFixed(fixedDecimals);if(!(t.hasClass('currency')&&!isInteger)&&val.indexOf('.')>-1&&autoCorrect){t.val(val.replace(/0*$/,'').replace(/\.$/,''));}else{t.val(val);}
if(t.hasClass('percent0to100')){if(val<0||val>100){error='You must enter a number from 0 to 100';}}
if(t.hasClass('range5to50')){if(val<5||val>50){error="Please enter a whole number between 5 and 50";}}
if(t.hasClass('reasonableyear')){if(val<2000){error='Please enter a reasonable year (2000 or later)';}}
if(t.hasClass('range1to360')){if(val<1||val>360){error="You must enter a number between 1 and 360";}}
if(t.hasClass('nonnegative')){if(val<0){error='You must enter a non-negative number';}}}}else if(t.hasClass('string')){if(t.hasClass('plantitle')){if(t.val().length<4||t.val().length>60){error='Plan name must be between 4 and 60 characters long';}}
if(t.hasClass('nonblank')){if(t.val().length===0){error='You must enter a value';}}}
var tooltip;if(t.hasClass('numeric')||t.hasClass('string')){if(error){t.removeClass('valid');t.addClass('invalid');t.addClass('error');if(t.data('tooltip')){tooltip=t.data('tooltip');}else{tooltip=$j('<div class="error-tooltip-wrapper"><div class="error-tooltip"><div class="error-tooltip-inner"></div><div class="error-tooltip-base"></div></div></div>');var tPos=t.position();tooltip.hide();t.parent().prepend(tooltip);t.data('tooltip',tooltip);}
tooltip.find('.error-tooltip-inner').text(error);}else{t.removeClass('invalid');t.removeClass('error');t.addClass('valid');if(t.data('tooltip')){t.data('tooltip').remove();t.data('tooltip',false);}}}else{t.removeClass('invalid');t.removeClass('error');t.removeClass('valid');}},showCommunique:function(){if($j('.communique-wrapper').hasClass('communique-hidden')){$j('.communique-wrapper').hide().removeClass('communique-hidden').animate({opacity:1},0).slideDown();}},hideCommunique:function(){$j('.communique-wrapper').animate({opacity:0},600).slideUp(600,function(){$j(this).find('.communique').remove();$j('.communique-wrapper').addClass('communique-hidden');});},disableSelect:function(){window.document.onselectstart=function(){return false;};},enableSelect:function(){window.document.onselectstart=null;},blockUI:function(){if($j('#click-block-overlay').length===0){var divString='<div id="click-block-overlay" style="display:none;position:fixed; width:100%;height:100%;top:0;left:0;z-index:20000;"/>';$j('body').prepend(divString);}
$j('#click-block-overlay').show();},unblockUI:function(){$j('#click-block-overlay').hide();},setSortableItemBusy:function(item){if(item){$j(item).find('.drag-handle').addClass("drag-loading");}
bpo.blockUI();},endSortableBusy:function(){$j('.drag-loading').removeClass('drag-loading');bpo.unblockUI();},tableReorderInit:function(list,updateFunction){list.sortable({cursor:'move',placeholder:'placeholder',tolerance:'pointer',scrollSensitivity:40,update:updateFunction});},limitCommentText:function(field,limitNum){var limitField=$j(field).parent().find(".newCommentText");var limitCount=$j(field).parent().find(".newCommentCountdown");var trimmedText=$j.trim($j(limitField).val());var remaining=limitNum-trimmedText.length;var str=remaining.toString()+" characters remaining";if(remaining<0){limitCount.addClass('comment-error');}
else{limitCount.removeClass('comment-error');}
$j(limitCount).text(str);if(!$j(field).data('addButton')){if($j(field).parents('.comment').find('.add-comment').length>0){$j(field).data('addButton',$j(field).parents('.comment').find('.add-comment'));}
else{$j(field).data('addButton',$j(field).parents('.comment').find('.save-comment'));}}
var addButton=$j(field).data('addButton');if(remaining<0||remaining===limitNum){addButton.addClass('disabled');}else{addButton.removeClass('disabled');}},setTableListItemBusy:function(item){$j(item).append("<div class='table-list-item-overlay'></div>");},initSaveButtonEnabler:function(root_selector){$j(root_selector+' input, '+root_selector+' select').live('change keyup keydown',function(event){$j(root_selector+' .button-submit').removeClass('disabled');});$j(root_selector+' .button-submit').addClass('disabled').removeClass('active');},setSaveButtonDisabled:function(root_selector){$j(root_selector+' .button-submit').addClass('disabled').removeClass('active');},setSaveButtonActive:function(root_selector){$j(root_selector+' .button-submit').removeClass('disabled').addClass('active');},isSaveButtonEnabled:function(root_selector){return!($j(root_selector+' .button-submit').hasClass('disabled'));},recenterPreview:function(preview_id){try{var h=$j('#'+preview_id+' .overlay-tl').height()+$j('#'+preview_id+' .overlay-bwrap').height();$j('#'+preview_id).height(h);Ext.WindowMgr.get(preview_id).center();}catch(e){}
bpo.unblockUI();}};Number.prototype.roundToNearest=function(nearest){var number=this;if(nearest>number||nearest<=0){return 0;}
var y,x=number%nearest;return x<nearest/2?number-x:number+(nearest-x);};Ext.namespace('bpo.message');bpo.message={MessageBox:Ext.extend(Ext.ux.Overlay,{constructor:function(cfg){cfg=cfg||{};var closeFn=function(){this.destroy();};Ext.apply(cfg,{dialog:true,hideBorders:true});if(cfg.text){var patt=/^<div|<\/div>$/im;if(cfg.text.search(patt)<0){cfg.html='<p>'+cfg.text+'</p>';}
else{cfg.html=cfg.text;}}
bpo.message.MessageBox.superclass.constructor.call(this,cfg);}}),alert:function(text,title,callback,cfg){cfg=cfg||{};if(!cfg.buttonText){cfg.buttonText="OK".l();}
var alertBox;Ext.apply(cfg,{buttons:[{xtype:'aquabutton',color:'primary',text:cfg.buttonText,handler:function(){alertBox.destroy();if(Ext.isFunction(callback)){callback();}}}],text:text,title:(title||"Attention".l())});alertBox=new bpo.message.MessageBox(cfg);bpo.unblockUI();alertBox.show();},alertBar:function(text){$j('body').showMessage({'className':'banner-message','thisMessage':[text],'opacity':95,'displayNavigation':false,'autoClose':true,'delayTime':6000});},errorBar:function(text,opt){var settings={'className':'fail','thisMessage':[text],'opacity':95,'displayNavigation':true,'autoClose':false,'delayTime':4000,'closeText':'Close','escText':''};if(typeof opt==='object'){settings=Ext.apply(settings,opt);}
$j('body').showMessage(settings);},richMessageAsSkirtError:function(){var errorMessageElement=$j('.rich-messages.js-as-skirt-error span.rich-messages-label, .rich-message.js-as-skirt-error span.rich-message-label');var errorMessage=errorMessageElement.text();if(errorMessage.length>0){if(errorMessageElement.parent("dt").hasClass("info")){bpo.message.alertBar(errorMessage);}
else{bpo.message.errorBar(errorMessage);}}},richMessageAsAlert:function(title){var errorMessageElement=$j('.rich-messages.js-as-alert span.rich-messages-label, .rich-message.js-as-alert span.rich-message-label');var errorMessage=errorMessageElement.text();if(errorMessage.length>0){if(errorMessageElement.parent("dt").hasClass("info")){bpo.message.alertBar(errorMessage);}
else{bpo.message.alert(errorMessage,title);}}},iconTpl:new Ext.Template('<table><tbody><tr><td style="width: 64px;"><img src="{icon}" style="margin-right: 15px;" /></td><td><p>{text}</p></td></tr></tbody></table>'),error:function(text,title,callback,cfg,extended){var errorBox;cfg=cfg||{};cfg=Ext.apply(cfg,{closable:false,buttons:(cfg.noButtons?[]:[{xtype:'aquabutton',color:'primary',text:'OK'.l(),handler:function(){if(!cfg.fatal){errorBox.destroy();}
if(callback){if(Ext.isFunction(callback)){callback();}}}}]),title:(title||"Attention".l())});if(!cfg.icon){cfg.icon='images/sprites/warning_48.png';}
if(window.fatalError){return;}
if(cfg.fatal){window.fatalError=true;Ext.WindowMgr.each(function(w){w.hide(false);w.destroy();});}
cfg.items=[{html:bpo.message.iconTpl.apply({'icon':cfg.icon,'text':text})}];if(extended){cfg.items.push({html:'<p style="margin: 20px 0 0 0">Exception:</p><textarea style="width: 650px; height: 100px;">'+extended+'</textarea>',unstyled:true});cfg.width=700;}
errorBox=new bpo.message.MessageBox(cfg);bpo.unblockUI();errorBox.show();return errorBox;},confirm:function(title,msg,fn,scope,cfg){var handle,confirmBox;if(!cfg){cfg={};}
if(!cfg.buttonText){cfg.buttonText={yes:'Confirm'.l(),no:'Cancel'.l(),or:'or'.l()};}
if(!cfg.buttonColors){cfg.buttonColors={yes:'primary',no:'text'};}
handle=function(btn){confirmBox.destroy();if(Ext.isFunction(fn)){scope=scope||this;fn.call(scope,btn.id);}};cfg=Ext.applyIf(cfg,{'closable':false,'cls':'confirm','title':title||"Please confirm".l(),'text':msg,'buttons':[{'xtype':'aquabutton','text':cfg.buttonText.no,'color':cfg.buttonColors.no,'handler':handle,'id':'no'},cfg.buttonText.or,{'xtype':'aquabutton','text':cfg.buttonText.yes,'color':cfg.buttonColors.yes,'handler':handle,'id':'yes'}]});confirmBox=new bpo.message.MessageBox(cfg);bpo.unblockUI();confirmBox.show();return confirmBox;}};bpo.message.prompt=function(settings,currentValue,callback){var save,closeOverlay,overlay,promptItems;var title=settings.title||"Rename Item".l();var prompt=settings.prompt||"New name:".l();var confirmText=settings.confirmText||"Save".l();var cancelText=settings.cancelText||"Cancel".l();var orText=settings.cancelText||"or".l();var cssClass=settings.cssClass||"renameOverlay";var textBoxSettings={xtype:'textfield',itemId:'newValue',width:272,value:currentValue,selectOnFocus:true};textBoxSettings=Ext.apply(textBoxSettings,settings);textBoxSettings=Ext.applyIf(textBoxSettings,{allowBlank:false});var textbox=new Ext.form.TextField(textBoxSettings);save=function(button,event){if(textbox.validate()){var newValue=textbox.getValue();callback(newValue,overlay);overlay.destroy();}else{return;}};closeOverlay=function(button,event){overlay.destroy();};promptItems=[{html:"<h3>"+prompt+"</h3>",border:false},textbox];if(settings.items){promptItems=promptItems.concat(settings.items);}
overlay=new Ext.ux.Overlay({title:title,dialog:true,cls:cssClass,items:promptItems,buttons:[{itemId:'cancel',text:cancelText,xtype:'aquabutton',color:'text',handler:closeOverlay,scope:this},orText,{itemId:'ok',text:confirmText,xtype:'aquabutton',color:'primary',handler:save,scope:this}]});overlay.on('show',function(){if(textBoxSettings.hasOwnProperty('maxLength')){textbox.el.set({maxLength:textBoxSettings.maxLength});}
textbox.focus.defer(250,textbox);});bpo.unblockUI();overlay.show();var okButton=overlay.getFooterToolbar().getComponent('ok');textbox.on({'valid':function(){okButton.setDisabled(false);},'invalid':function(){okButton.setDisabled(true);}});textbox.on('specialkey',function(cmp,e){switch(e.getKey()){case e.ENTER:save();break;case e.ESC:closeOverlay();break;}});};dwr.engine.setTimeout(0);bpo.remoteError=function(msg,exception){if(exception==='dwr.engine.timeout'||msg.indexOf('Bad Request')>-1){return;}
switch(exception.javaClassName){case"#":bpo.handleLogoutFromNewSession();break;case"#":bpo.handleLogoutFromInactivity();break;case"org.directwebremoting.extend.ServerException":bpo.trackEvent('error','dwr input payload error','dwr received a request from the browser that appears to be incomplete');break;case"dwr.engine.batchBegun":bpo.trackEvent('error','dwr batch begun','dwr has tried to start a new batch after it already started a batch');break;default:if(window.debug){bpo.message.error(msg,"Well, that was strange...".l(),false,{},dwr.util.toDescriptiveString(exception,2));}else{bpo.message.error('<p>'+"Sorry, something unexpected happened.".l()+'</p><p>'+"Please click OK, and try again.".l()+'</P>',"Well, that was strange...".l(),false,{});}
break;}};bpo.remoteWarning=function(msg,exception){if(window.unloading){return;}
if(exception.name==='dwr.engine.missingData'){if(bpo.online){bpo.eventbus.fireEvent('lostconnection');}}};Ext.onReady(function(){dwr.engine.setErrorHandler(bpo.remoteError);dwr.engine.setWarningHandler(bpo.remoteWarning);$j(window).unload(function(){window.unloading=true;});window.unloading=false;});Ext.onReady(function(){var readOnlyStatus,consecutiveLostConnections=0;bpo.eventbus.on({'lostconnection':function(){consecutiveLostConnections+=1;if(consecutiveLostConnections>1){bpo.online=false;bpo.message.errorBar('Having trouble connecting to the server. Retrying...'.l(),{autoClose:false,displayNavigation:false,neverHide:true});if(bpo.widgetRegistry){readOnlyStatus=bpo.widgetRegistry.getReadOnly();bpo.widgetRegistry.setReadOnly(true);if(bpo.widgetRegistry.getEditor()){bpo.widgetRegistry.getEditor().preview();}}}},'restoredconnection':function(){consecutiveLostConnections=0;if(bpo.widgetRegistry){bpo.widgetRegistry.setReadOnly(readOnlyStatus);}
$j('#showMessage').fadeOut(function(){bpo.message.alertBar('Internet connection restored'.l());});}});});bpo.eventbus=new Ext.util.Observable({events:['poll','changepage','lostconnection','restoredconnection','plandatachange']});bpo.eventbus.on("poll",bpo.checkLoggedInStatus);bpo.poller=Ext.TaskMgr.start({interval:60000,run:function(count){bpo.eventbus.fireEvent('poll',count);}});bpo.poller.stop=function(){Ext.TaskMgr.stop(bpo.poller);};bpo.dwrBatch=(function(){var inBatch=false;var eb=function(){if(inBatch){window.dwr.engine.endBatch();inBatch=false;}};var deb=new Ext.util.DelayedTask(eb);return({isInBatch:function(){return inBatch;},beginBatch:function(ms){if(!inBatch){window.dwr.engine.beginBatch();inBatch=true;}
if(ms){deb.delay(ms);}},endBatch:eb,delayEndBatch:function(ms){deb.delay(ms||2000);}});}());Ext.ns('bpo.component');bpo.component.PreviewOverlay=Ext.extend(Ext.ux.Overlay,{initComponent:function(){var config={footerStyle:'height: 0px;',autoShow:true,autoScroll:true,closeAction:'hide',toolTemplate:new Ext.Template('<a href="" class="{id} closebutton">&#160;</a>')};Ext.apply(this,config);bpo.component.PreviewOverlay.superclass.initComponent.apply(this,arguments);}});Ext.ns('bpo.timer');bpo.timer=(function(){var registry={},now=function(){return(new Date()).getTime();},initTimer=function(label){registry[label]=now();},getTime=function(label){return(now()-(registry[label]||0));},getSeconds=function(label){return Math.ceil(getTime(label)/1000);};return{start:function(label){if(!label){label=Ext.id(undefined,'timer');}
initTimer(label);return label;},stop:function(label){return getSeconds(label);},page:function(category,action,label){var id=initTimer();bpo.eventbus.on('changepage',function(){var timeOnPage=getSeconds(id);bpo.trackEvent(category,action,label,timeOnPage);},undefined,{single:true});},getRegistry:function(){return registry;}};}());Ext.ns('bpo.previewTable');bpo.previewTable={init:(function(){var moveFns={start:'mousedown touchstart',end:'mouseup touchend',move:'mousemove touchmove'};var normalizePageX=function(event){if(event.type.indexOf('touch')===0){return event.originalEvent.touches[0].pageX;}else{return event.pageX;}};var fn=function(){$j('.preview-table-wrapper:visible').each(function(){var el=$j(this),fullWidth;if(el.data('initialized')){return;}else{var maxWidth=0;el.find('.preview-table').each(function(){var tableEl=$j(this);fullWidth=tableEl.find('.row-header .cell').totalWidth();if(fullWidth>tableEl.width()){tableEl.width(fullWidth);}
maxWidth=Math.max(maxWidth,fullWidth);var groupHeaderWidth=tableEl.find('.row-group_header:first .cell').totalWidth();if(groupHeaderWidth>tableEl.width()){tableEl.width(groupHeaderWidth);}
maxWidth=Math.max(maxWidth,groupHeaderWidth);});if($j("div#preview.overlay").length>0){maxWidth=865;}
el.find('.preview-table-wrapper-inner').width(maxWidth);el.data('initialized',true);}
var labelColumn=el.find('span.label');el.bind('jsp-initialised',function(event,isScrollable){var maskDiv=el.next('.preview-table-mask');var pos=el.position();maskDiv.css({top:pos.top}).width(el.width()).height(el.height()-16);if(isScrollable){maskDiv.addClass('masked-right');}
el.find('.jspTrack').addClass('do-not-edit');}).bind('jsp-scroll-x',function(event,scrollPositionX,isAtBottom,isAtTop){var maskDiv=el.add(el.next('.preview-table-mask'));maskDiv.removeClass('masked-left masked-right masked-both');labelColumn.css({'left':scrollPositionX});if(!isAtBottom&&!isAtTop){maskDiv.addClass('masked-both');}else if(!isAtBottom){maskDiv.addClass('masked-left');}else if(!isAtTop){maskDiv.addClass('masked-right');}}).jScrollPane({horizontalGutter:20});var jsPane=el.data("jsp");el.next('.preview-table-mask').bind(moveFns.start,function(e){bpo.disableSelect();var startPos=normalizePageX(e)+jsPane.getContentPositionX();var dragTarget=$j(this);dragTarget.removeClass('do-not-edit');var startingX=jsPane.getContentPositionX();var mousemoveFn=function(e){var xVal=(e.type==='touchmove'?e.originalEvent.touches[0].pageX:e.pageX);jsPane.scrollToX(startPos-normalizePageX(e));if(Math.abs(startingX-jsPane.getContentPositionX())>10){dragTarget.addClass('do-not-edit');}
dragTarget.addClass('dragging');};var body=$j(document.body);body.bind(moveFns.move,mousemoveFn);$j(window).add(document.body).one(moveFns.end,function(e){body.unbind(moveFns.move,mousemoveFn);var removeDoNotEdit=function(){dragTarget.removeClass('do-not-edit').removeClass('dragging');bpo.enableSelect();};window.setTimeout(removeDoNotEdit,1);});});});};return function(){fn.defer(1);};}())};